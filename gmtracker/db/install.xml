<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="mod/gmtracker/db" VERSION="2025101703" COMMENT="XMLDB file for Google Meet Tracker module" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd">

    <TABLES>

        <!-- Main table storing each meeting -->
        <TABLE NAME="gmtracker" COMMENT="Stores Google Meet session information">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="Primary key" />
                <FIELD NAME="course" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Course ID" />
                <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" COMMENT="Meeting name" />
                <FIELD NAME="intro" TYPE="text" NOTNULL="false" COMMENT="Meeting description" />
                <FIELD NAME="introformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" COMMENT="Intro format" />
                <!-- CHANGED: gmeetlink now allows NULL for onsite meetings -->
                <FIELD NAME="gmeetlink" TYPE="text" NOTNULL="false" COMMENT="Google Meet link" />
                <FIELD NAME="hostemail" TYPE="char" LENGTH="255" NOTNULL="true" COMMENT="Host email" />
                <FIELD NAME="meetingdate" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Unix timestamp of meeting start" />
                <FIELD NAME="duration" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Duration in minutes" />
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Last modified timestamp" />
                <!-- Onsite Training -->
                <FIELD NAME="meetingtype" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="'online'" COMMENT="Meeting type: online or onsite" />
                <FIELD NAME="location" TYPE="text" NOTNULL="false" COMMENT="Physical location for onsite meetings" />
                <FIELD NAME="joincode" TYPE="char" LENGTH="6" NOTNULL="false" COMMENT="Join code for onsite meetings" />
                <FIELD NAME="leavecode" TYPE="char" LENGTH="6" NOTNULL="false" COMMENT="Leave code for onsite meetings" />
                <!-- CALENDAR INTEGRATION -->
                <FIELD NAME="addtocalendar" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" COMMENT="Add to calendar flag (0=no, 1=yes)" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="coursefk" TYPE="foreign" FIELDS="course" REFTABLE="course" REFFIELDS="id" />
            </KEYS>
        </TABLE>

        <!-- Table for attendance tracking -->
        <TABLE NAME="gmtracker_attendance" COMMENT="Records user join/leave times for meetings">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="Primary key" />
                <FIELD NAME="gmtrackerid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="FK to gmtracker" />
                <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="User ID" />
                <FIELD NAME="jointime" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Join timestamp" />
                <FIELD NAME="leavetime" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Leave timestamp" />
                <FIELD NAME="duration" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Total duration in seconds" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="gmtrackerfk" TYPE="foreign" FIELDS="gmtrackerid" REFTABLE="gmtracker" REFFIELDS="id" />
                <KEY NAME="userfk" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id" />
            </KEYS>
        </TABLE>

    </TABLES>
</XMLDB>